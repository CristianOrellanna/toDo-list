<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!--icon-->
    <link
      rel="shortcut icon"
      href="https://i.ibb.co/Dr0K79R/tick.png"
    />
    <!--CSS-->
    <link rel="stylesheet" href="/css/styles.css" />
    <!--Bootstrap-->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"></script>
    <title>Registrarse</title>
  </head>
  <body>
    <div
      class="modal modal-sheet position-static d-block bg-body-secondary p-4 py-md-5"
      tabindex="-1"
      role="dialog"
      id="modalRegister"
    >
      <div class="modal-dialog" role="document">
        <div class="modal-content rounded-4 shadow">
          <div class="modal-header p-5 pb-4 border-bottom-0">
            <div class="mb-2">
              <h1 class="fw-bold mb-1 fs-2">Registro</h1>
              <p class="text-secondary mb-0 mt-0">
                Completa el siguiente formulario para registrarte.
              </p>
            </div>
          </div>

          <div class="modal-body p-5 pt-0">
            <form
              id="user-registration"
              action="/user-registration"
              method="POST"
            >
              <div class="form-floating mb-3">
                <input
                  type="text"
                  class="form-control rounded-3"
                  id="nombre"
                  name="nombre"
                  placeholder="Juan Perez"
                  required
                />
                <label for="nombre">Nombre</label>
              </div>
              <div class="form-floating mb-3">
                <input
                  type="text"
                  class="form-control rounded-3"
                  id="username"
                  name="username"
                  placeholder="Username"
                  required
                />
                <label for="username">Usuario</label>
              </div>
              <div class="form-floating mb-3">
                <input
                  type="email"
                  class="form-control rounded-3"
                  id="email"
                  name="email"
                  placeholder="Email"
                  required
                />
                <label for="email">Correo</label>
              </div>
              <div class="form-floating mb-3">
                <input
                  type="password"
                  class="form-control rounded-3"
                  id="password"
                  name="password"
                  placeholder="Mín. 8 caracteres con letras y números"
                  required
                  pattern="(?=.*\d)(?=.*[a-zA-Z]).{8,}"
                  oninvalid="this.setCustomValidity('La contraseña debe tener al menos 8 caracteres con letras y números')"
                  oninput="this.setCustomValidity('')"
                />
                <label for="password">Contraseña</label>
              </div>
              <button
                class="w-100 mb-2 btn btn-lg rounded-3 btn-dark"
                type="submit"
              >
                Realizar registro
              </button>
              <hr class="my-4" />
              <small
                class="text-body-secondary d-block mx-auto text-center my-3"
                >¿Ya estás registrado?</small
              >
              <button
                type="button"
                class="w-100 py-2 mb-2 btn btn-outline-dark rounded-3"
                onclick="location.href='/login';"
              >
                Iniciar sesión
              </button>
              <button
                type="button"
                class="w-100 py-2 mb-2 btn btn-outline-dark rounded-3"
                onclick="location.href='/';"
              >
                Volver al inicio
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!--SweetAlert script -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
      const registerForm = document.getElementById("user-registration");

      registerForm.addEventListener("submit", async (event) => {
        // Evitar que el formulario se envíe de la forma tradicional
        event.preventDefault();

        const formData = new FormData(registerForm);
        const data = {
          name: formData.get("nombre"),
          username: formData.get("username"),
          email: formData.get("email"),
          password: formData.get("password"),
        };

        try {
          const response = await fetch("/user-registration", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(data),
          });

          const result = await response.json();

          if (result.success) {
            Swal.fire({
              title: "¡Éxito!",
              text: result.message,
              icon: "success",
              confirmButtonColor: "#3085d6",
              confirmButtonText: "Ok",
            }).then(() => {
              window.location.href = result.redirect;
            });
          } else {
            Swal.fire({
              title: "Error",
              text: result.message,
              icon: "error",
              confirmButtonColor: "d33",
              confirmButtonText: "Intentar de nuevo",
            });
          }
        } catch (error) {
          console.error("Error:", error);
          Swal.fire({
            title: "Error",
            text: "Ocurrió un problema durante el registro.",
            icon: "error",
            confirmButtonColor: "d33",
            confirmButtonText: "Intentar de nuevo",
          });
        }
      });
    </script>
  </body>
</html>
