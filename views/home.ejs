<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <!--icon-->
        <link rel="shortcut icon" href="https://i.ibb.co/Dr0K79R/tick.png" />
        <!--CSS-->
        <link rel="stylesheet" href="/css/styles.css">
        <!-- Sweetalert -->
        <link rel="stylesheet" href="sweetalert2.min.css">
      <!--Bootstrap-->
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet">
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"></script>
    <title>Home</title>
</head>
<body>

  <div class="container vh-100">
    <div class="row justify-content-center align-items-center h-100">
        <div class="col-lg-6 text-center">
            <h1 class="display-5 fw-bold text-body-emphasis">Hola <%= name %></h1>
            <p class="lead mb-4">¿Qué quieres hacer?</p>
            <div class="mt-3 d-grid gap-2 d-sm-flex justify-content-sm-center">
                <button type="button" class="btn btn-outline-dark btn-lg px-4 gap-3" onclick="location.href='/tareas/agregar';">Agregar tarea</button>
                <button type="button" class="btn btn-outline-dark btn-lg px-4" onclick="location.href='/tareas/mostrar';">Ver mis tareas</button>
            </div>
            <div class="mt-3 d-grid gap-2 d-sm-flex justify-content-sm-center">
<!-- Elimina el atributo onclick del botón -->
<button type="button" id="logoutButton" class="btn btn-outline-danger btn-lg px-4 rounded-3">Cerrar sesión</button>

            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>

const logoutButton = document.getElementById('logoutButton');

logoutButton.addEventListener('click', () => {
  Swal.fire({
    title: '¿Estás seguro?',
    text: '¿Deseas cerrar tu sesión?',
    icon: 'warning',
    showCancelButton: true,
    confirmButtonColor: '#3085d6',
    cancelButtonColor: '#d33',
    confirmButtonText: 'Sí, cerrar sesión',
    cancelButtonText: 'Cancelar'
  }).then(async (result) => {
    if (result.isConfirmed) {
      try {
        const response = await fetch('/logout', {
          method: 'GET'
        });

        const result = await response.json();

        if (result.success) {
          Swal.fire({
            title: 'Sesión Cerrada',
            text: result.message,
            icon: 'success',
            confirmButtonColor: '#3085d6',
            confirmButtonText: 'Ok'
          }).then(() => {
            // Redirige a la página principal
            window.location.href = result.redirect;
          });
        } else {
          Swal.fire({
            title: 'Error',
            text: 'Ocurrió un problema al cerrar sesión.',
            icon: 'error',
            confirmButtonColor: "#d33",
            confirmButtonText: 'Intentar de nuevo'
          });
        }
      } catch (error) {
        Swal.fire({
          title: 'Error',
          text: 'Ocurrió un problema al cerrar sesión.',
          icon: 'error',
          confirmButtonText: 'Intentar de nuevo'
        });
      }
    }
  });
});
</script>

</body>
</html>